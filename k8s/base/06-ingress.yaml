# ==============================================================================
# DinariBlockchain - Ingress (Cloud-Agnostic)
# Uses standard Ingress resource
# For cloud-specific ingress controllers, use overlays
# ==============================================================================

---
# Mainnet RPC Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: dinari-mainnet-rpc-ingress
  namespace: dinari-mainnet
  labels:
    app: dinari-blockchain
    network: mainnet
  annotations:
    # Generic annotations (work everywhere)
    kubernetes.io/ingress.class: "nginx"  # Or your ingress controller
    cert-manager.io/cluster-issuer: "letsencrypt-prod"  # For automatic TLS
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    
    # Rate limiting
    nginx.ingress.kubernetes.io/limit-rps: "100"
    nginx.ingress.kubernetes.io/limit-connections: "10"
    
    # Timeouts
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    
    # Security headers
    nginx.ingress.kubernetes.io/configuration-snippet: |
      more_set_headers "X-Frame-Options: DENY";
      more_set_headers "X-Content-Type-Options: nosniff";
      more_set_headers "X-XSS-Protection: 1; mode=block";
spec:
  tls:
  - hosts:
    - api.dinariblockchain.network/
    secretName: dinari-mainnet-tls-cert  # Auto-generated by cert-manager
  
  rules:
  - host: api.dinariblockchain.network/
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: dinari-mainnet-rpc
            port:
              number: 8545

---
# Testnet RPC Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: dinari-testnet-rpc-ingress
  namespace: dinari-testnet
  labels:
    app: dinari-blockchain
    network: testnet
  annotations:
    kubernetes.io/ingress.class: "nginx"
    cert-manager.io/cluster-issuer: "letsencrypt-staging"
    nginx.ingress.kubernetes.io/ssl-redirect: "false"  # More permissive for testnet
spec:
  tls:
  - hosts:
    - testnet-api.dinariblockchain.network/
    secretName: dinari-testnet-tls-cert
  
  rules:
  - host: testnet-api.dinariblockchain.network/
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: dinari-testnet-rpc
            port:
              number: 8545